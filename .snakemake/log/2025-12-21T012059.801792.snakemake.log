host: DESKTOP-RIOPIIU
Building DAG of jobs...
Provided cores: 1 (use --cores to define parallelism)
Rules claiming more threads will be scaled down.
Job stats:
job                    count
-------------------  -------
decision_bundle            1
safety_feature             3
similarity_feature         3
structural_features        1
total                      8

Select jobs to execute...
Execute 1 jobs...

[Sun Dec 21 01:20:59 2025]
localrule safety_feature:
    output: cache/features/safety/P001.json
    jobid: 5
    reason: Forced execution
    wildcards: phage_id=P001
    resources: tmpdir=C:\Users\egzbi\AppData\Local\Temp

python scripts/modules/safety_compile.py --phage-id P001 --out cache/features/safety/P001.json --mock
[Sun Dec 21 01:21:00 2025]
Finished job 5.
1 of 8 steps (12%) done
Select jobs to execute...
Execute 1 jobs...

[Sun Dec 21 01:21:00 2025]
localrule similarity_feature:
    output: cache/features/similarity/H001/P001.json
    jobid: 1
    reason: Missing output files: cache/features/similarity/H001/P001.json
    wildcards: host_id=H001, phage_id=P001
    resources: tmpdir=C:\Users\egzbi\AppData\Local\Temp

python scripts/modules/sourmash_containment.py --host-id H001 --phage-id P001 --out cache/features/similarity/H001/P001.json --mock
[Sun Dec 21 01:21:00 2025]
Finished job 1.
2 of 8 steps (25%) done
Select jobs to execute...
Execute 1 jobs...

[Sun Dec 21 01:21:00 2025]
localrule safety_feature:
    output: cache/features/safety/P002.json
    jobid: 6
    reason: Missing output files: cache/features/safety/P002.json
    wildcards: phage_id=P002
    resources: tmpdir=C:\Users\egzbi\AppData\Local\Temp

python scripts/modules/safety_compile.py --phage-id P002 --out cache/features/safety/P002.json --mock
[Sun Dec 21 01:21:00 2025]
Finished job 6.
3 of 8 steps (38%) done
Select jobs to execute...
Execute 1 jobs...

[Sun Dec 21 01:21:00 2025]
localrule similarity_feature:
    output: cache/features/similarity/H001/P002.json
    jobid: 2
    reason: Forced execution
    wildcards: host_id=H001, phage_id=P002
    resources: tmpdir=C:\Users\egzbi\AppData\Local\Temp

python scripts/modules/sourmash_containment.py --host-id H001 --phage-id P002 --out cache/features/similarity/H001/P002.json --mock
[Sun Dec 21 01:21:00 2025]
Finished job 2.
4 of 8 steps (50%) done
Select jobs to execute...
Execute 1 jobs...

[Sun Dec 21 01:21:00 2025]
localrule safety_feature:
    output: cache/features/safety/P003.json
    jobid: 7
    reason: Missing output files: cache/features/safety/P003.json
    wildcards: phage_id=P003
    resources: tmpdir=C:\Users\egzbi\AppData\Local\Temp

python scripts/modules/safety_compile.py --phage-id P003 --out cache/features/safety/P003.json --mock
[Sun Dec 21 01:21:00 2025]
Finished job 7.
5 of 8 steps (62%) done
Select jobs to execute...
Execute 1 jobs...

[Sun Dec 21 01:21:00 2025]
localrule structural_features:
    output: cache/features/structural/H001
    jobid: 4
    reason: Missing output files: cache/features/structural/H001
    wildcards: host_id=H001
    resources: tmpdir=C:\Users\egzbi\AppData\Local\Temp

python scripts/modules/foldseek_summarise.py --host-id H001 --phage-ids P001,P002,P003 --out-dir cache\features\structural\H001 --mock
[Sun Dec 21 01:21:01 2025]
Finished job 4.
6 of 8 steps (75%) done
Select jobs to execute...
Execute 1 jobs...

[Sun Dec 21 01:21:01 2025]
localrule similarity_feature:
    output: cache/features/similarity/H001/P003.json
    jobid: 3
    reason: Missing output files: cache/features/similarity/H001/P003.json
    wildcards: host_id=H001, phage_id=P003
    resources: tmpdir=C:\Users\egzbi\AppData\Local\Temp

python scripts/modules/sourmash_containment.py --host-id H001 --phage-id P003 --out cache/features/similarity/H001/P003.json --mock
[Sun Dec 21 01:21:01 2025]
Finished job 3.
7 of 8 steps (88%) done
Select jobs to execute...
Execute 1 jobs...

[Sun Dec 21 01:21:01 2025]
localrule decision_bundle:
    input: cache/features/similarity/H001/P001.json, cache/features/similarity/H001/P002.json, cache/features/similarity/H001/P003.json, cache/features/structural/H001, cache/features/safety/P001.json, cache/features/safety/P002.json, cache/features/safety/P003.json
    output: rankings/H001/ranking.csv, rankings/H001/evidence_bundle.json
    jobid: 0
    reason: Input files updated by another job: cache/features/safety/P002.json, cache/features/safety/P003.json, cache/features/safety/P001.json, cache/features/similarity/H001/P003.json, cache/features/structural/H001, cache/features/similarity/H001/P002.json, cache/features/similarity/H001/P001.json
    wildcards: host_id=H001
    resources: tmpdir=C:\Users\egzbi\AppData\Local\Temp


        python scripts/assemble_decision_bundle.py \
          --host-id H001 \
          --config config.yaml \
          --phage-manifest manifests/phages.tsv \
          --host-manifest manifests/hosts.tsv \
          --similarity-dir cache\features\similarity \
          --structural-dir cache\features\structural \
          --safety-dir cache\features\safety \
          --out-ranking rankings/H001/ranking.csv \
          --out-evidence rankings/H001/evidence_bundle.json
        
RuleException:
CalledProcessError in file C:\GIT\phage-match\workflow\pm_v0_1\Snakefile, line 296:
Command 'python scripts/assemble_decision_bundle.py \
          --host-id H001 \
          --config config.yaml \
          --phage-manifest manifests/phages.tsv \
          --host-manifest manifests/hosts.tsv \
          --similarity-dir cache\features\similarity \
          --structural-dir cache\features\structural \
          --safety-dir cache\features\safety \
          --out-ranking rankings/H001/ranking.csv \
          --out-evidence rankings/H001/evidence_bundle.json' returned non-zero exit status 2.
[Sun Dec 21 01:21:01 2025]
Error in rule decision_bundle:
    jobid: 0
    input: cache/features/similarity/H001/P001.json, cache/features/similarity/H001/P002.json, cache/features/similarity/H001/P003.json, cache/features/structural/H001, cache/features/safety/P001.json, cache/features/safety/P002.json, cache/features/safety/P003.json
    output: rankings/H001/ranking.csv, rankings/H001/evidence_bundle.json
    shell:
        
        python scripts/assemble_decision_bundle.py \
          --host-id H001 \
          --config config.yaml \
          --phage-manifest manifests/phages.tsv \
          --host-manifest manifests/hosts.tsv \
          --similarity-dir cache\features\similarity \
          --structural-dir cache\features\structural \
          --safety-dir cache\features\safety \
          --out-ranking rankings/H001/ranking.csv \
          --out-evidence rankings/H001/evidence_bundle.json
        
        (one of the commands exited with non-zero exit code; note that snakemake uses bash strict mode!)

Shutting down, this might take some time.
Exiting because a job execution failed. Look above for error message
Complete log: .snakemake\log\2025-12-21T012059.801792.snakemake.log
WorkflowError:
At least one job did not complete successfully.
